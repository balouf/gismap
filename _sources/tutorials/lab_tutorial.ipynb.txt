{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "0",
   "metadata": {},
   "source": [
    "# LabMaps"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1",
   "metadata": {},
   "source": [
    ":::note\n",
    "\n",
    "By default, we query both HAL and LDB. Don't hesitate to adapt depending on the use case.\n",
    ":::"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2",
   "metadata": {},
   "source": [
    "## Lab authors"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3",
   "metadata": {},
   "source": [
    "Lab authors are the main ingredient to analyse a single lab (i.e. a group of researchers). You can create one just with a name and then automatically ask to retrieve the DB endpoints for this author."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "4",
   "metadata": {},
   "outputs": [],
   "source": [
    "from gismap.lab import LabAuthor\n",
    "\n",
    "maria = LabAuthor(\"Maria Potop\")\n",
    "maria.auto_sources()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5",
   "metadata": {},
   "source": [
    "Let's look at the sources:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6",
   "metadata": {},
   "outputs": [],
   "source": [
    "maria.sources"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7",
   "metadata": {},
   "source": [
    "Hum, a bit crowded in this specific case. Maybe we can specify a bit:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8",
   "metadata": {},
   "outputs": [],
   "source": [
    "maria.sources = maria.sources[:2]"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9",
   "metadata": {},
   "source": [
    "Note that an author can have many names."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "10",
   "metadata": {},
   "outputs": [],
   "source": [
    "maria.aliases"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "11",
   "metadata": {},
   "source": [
    "\n",
    "When using `auto_source`, you can tell which DBs should be used (LDB, HAL, or DBLP)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "12",
   "metadata": {},
   "outputs": [],
   "source": [
    "celine = LabAuthor(\"Céline Comte\")\n",
    "celine.auto_sources(dbs=[\"hal\"])\n",
    "celine.sources"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "13",
   "metadata": {},
   "outputs": [],
   "source": [
    "celine = LabAuthor(\"Céline Comte\")\n",
    "celine.auto_sources(dbs=\"dblp\")\n",
    "celine.sources"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "14",
   "metadata": {},
   "outputs": [],
   "source": [
    "celine = LabAuthor(\"Céline Comte\")\n",
    "celine.auto_sources(dbs=\"ldb\")\n",
    "celine.sources"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "15",
   "metadata": {},
   "source": [
    "When the sources of an author are set one can retrieve her publications."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "16",
   "metadata": {},
   "outputs": [],
   "source": [
    "[p for p in celine.get_publications().values() if p.year == 2021]"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "17",
   "metadata": {},
   "source": [
    ":::note\n",
    "Lab authors can have metadata that can be used for display and further analysis. This is not covered in this tutorial.\n",
    ":::"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "18",
   "metadata": {},
   "source": [
    "## Your first lab"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "19",
   "metadata": {},
   "source": [
    "In GisMap, a LabMap is a class whose instances have three methods:\n",
    "\n",
    "- `update_authors` automatically refresh the members of the lab. It is useful at creation or when a lab evolves.\n",
    "- `update_publications` makes a full refresh of the publications of a lab. All publications from lab members are considered (temporal filtering may be enabled later).\n",
    "- `expand` adds *moons*, i.e. additional researchers that gravitate around the lab.\n",
    "\n",
    "The simplest usable subclass of Lab is `ListMap`, which uses a list of names. For example, consider the former team *Gangsta* from my Bell Labs days."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "20",
   "metadata": {},
   "outputs": [],
   "source": [
    "from gismap.lab import ListMap\n",
    "\n",
    "lab = ListMap(\n",
    "    author_list=[\n",
    "        \"Fabien Mathieu\",\n",
    "        \"Philippe Jacquet\",\n",
    "        \"Alonso Silva\",\n",
    "        \"Anne Bouillard\",\n",
    "        \"François Durand (hal: fradurand, ldb:38/11269)\",\n",
    "        \"Amira Alloum\",\n",
    "        \"Marc-Olivier Buob\",\n",
    "        \"Mohamed Lamine Lamali (hal:mohamed-lamine-lamali, ldb: 43/11358)\",\n",
    "    ],\n",
    "    name=\"Gangsta\",\n",
    ")\n",
    "lab.update_authors()\n",
    "lab.update_publis()\n",
    "len(lab.publications)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "21",
   "metadata": {},
   "source": [
    "Maps can be saved with the `dump` method so you don't have to re-update them all the time."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "22",
   "metadata": {},
   "source": [
    "When you have a populated lab, you can produce a standalone HTML of the collaboration graph with `save_html`. That graph is a standalone HTML that can be displayed in a notebook or saved for inclusion in a web page (e.g. with `iframe`).\n",
    "\n",
    "You can also display it directly inside a notebook. Using options, you can perform some customization if you want:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "23",
   "metadata": {},
   "outputs": [],
   "source": [
    "groups = {\"Gangsta\": {\"color\": \"rgb(255, 0, 255)\"}}\n",
    "lab.show_html(groups=groups)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "24",
   "metadata": {},
   "source": [
    "Let's add some context with a few moons."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "25",
   "metadata": {},
   "outputs": [],
   "source": [
    "lab.expand(target=4)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "26",
   "metadata": {},
   "outputs": [],
   "source": [
    "groups[\"moon\"] = {\"display\": \"Usual Suspects\", \"color\": \"rgb(0,255,0)\"}\n",
    "lab.show_html(groups=groups)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "27",
   "metadata": {},
   "source": [
    "Few things about the generated graph:\n",
    "\n",
    "- Authors are represented with their initials unless some picture url is provided (implicitly or explicitly).\n",
    "- Comets are singletons (authors with no co-publications with the other nodes). They are hidden by default. For example, if you only show the moons / usual suspects, Bernard becomes a comet and is hidden.\n",
    "- You can hover an author to get her name. If you click, you have a modal with the list of publications.\n",
    "- The width and length of an edge depend on the number of co-publications. If you click you have a modal with the list of co-publications."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "28",
   "metadata": {},
   "source": [
    "## How-to: Adding informal \"publications\""
   ]
  },
  {
   "cell_type": "markdown",
   "id": "29",
   "metadata": {},
   "source": [
    "Some people have asked for the possibility of manually adding some extra-publications that are not available on the DB. This addition is possible but not fully automated yet. Here is a toy example to show how to do that.\n",
    "\n",
    "First we need to build a lab."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "30",
   "metadata": {},
   "outputs": [],
   "source": [
    "from gismap.lab import ListMap\n",
    "\n",
    "lab = ListMap(author_list=[\"Fabien Mathieu\", \"Céline Comte\"], name=\"Dream Team\")\n",
    "lab.update_authors()\n",
    "lab.update_publis()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "31",
   "metadata": {},
   "source": [
    "Then we need the key of the publication's author."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "32",
   "metadata": {},
   "outputs": [],
   "source": [
    "lab.authors"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "33",
   "metadata": {},
   "source": [
    "Then we need to create the publication. For technical reason, all lab publications are sourced, so we need first to create a publication, assign a unique key to it, then use the result as a source."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "34",
   "metadata": {},
   "outputs": [],
   "source": [
    "from gismap.sources.models import Publication, Author\n",
    "from gismap.sources.multi import SourcedPublication\n",
    "\n",
    "collab = Publication(authors=[lab.authors['celine-comte'], lab.authors['fabien-mathieu'], Author(name=\"John Doe\")], \n",
    "                     title=\"Informal discussions on GisMap\", year=2026, \n",
    "                     type=\"Unpublished\", venue=\"Zoom meetings\")\n",
    "collab.key = \"discussion\"\n",
    "sourced_collab = SourcedPublication.from_sources([collab])"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "35",
   "metadata": {},
   "source": [
    "After that is done, all you need is to add the publication to the dictionnary."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "36",
   "metadata": {},
   "outputs": [],
   "source": [
    "lab.publications[sourced_collab.key] = sourced_collab\n",
    "lab.show_html()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "37",
   "metadata": {},
   "source": [
    "## Make your own LabMap"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "38",
   "metadata": {},
   "source": [
    "GisMap is intended to make easy the creation of LabMaps in many contexts.\n",
    "\n",
    "The easiest way to manage a lab, apart from using ListMaps as shown above, is to specify an internal method `_author_iterator` that returns Lab authors. When it's done, you can create/refresh LabMaps as you see fit.\n",
    "\n",
    "How the iterator works is 100% up to you. Most of the time, this is done by scrapping some Web page(s) (see the gallery for examples), but many other options exist, e.g. read authors from a file, from a LDAP...\n",
    "\n",
    "For example, [this is the entire code required for handling the Solace team](../_modules/gismap/lab_examples/toulouse.html#SolaceMap)."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
